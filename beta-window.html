<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZØRA Browser</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="//cdn.jsdelivr.net/npm/eruda"></script>

    <style>
        /* All your existing CSS styles remain the same */
        /* Copy all the CSS from your original file here */
    </style>
</head>
<body>
    <div class="browser-container">
        <div class="tab-bar" id="tabBar">
            <button class="new-tab-btn">+</button>
        </div>
        <div class="search-bar">
            <div class="nav-buttons">
                <button class="nav-button" id="backBtn" title="Back">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <button class="nav-button" id="forwardBtn" title="Forward">
                    <i class="fas fa-arrow-right"></i>
                </button>
                <button class="nav-button" id="refreshBtn" title="Refresh">
                    <i class="fas fa-redo"></i>
                </button>
            </div>
            <input type="text" class="search-input" placeholder="Search or enter URL">
            <div class="action-buttons">
                <button class="action-button" id="inspectBtn" title="Inspect">
                    <i class="fas fa-code"></i>
                </button>
                <button class="action-button fullscreen-button" id="fullscreenBtn" title="Fullscreen">
                    <i class="fas fa-expand"></i>
                </button>
                <button class="action-button" id="optionsBtn" title="More">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
                <div class="options-menu" id="optionsMenu">
                    <div class="menu-item" id="newTabOption">
                        <i class="fas fa-plus"></i>
                        <span>New tab</span>
                    </div>
                    <div class="menu-item" id="newWindowOption">
                        <i class="fas fa-window-maximize"></i>
                        <span>New window</span>
                    </div>
                    <div class="menu-item">
                        <i class="fas fa-history"></i>
                        <span>History</span>
                    </div>
                    <div class="menu-item">
                        <i class="fas fa-download"></i>
                        <span>Downloads</span>
                    </div>
                    <div class="menu-item">
                        <i class="fas fa-bookmark"></i>
                        <span>Bookmarks</span>
                    </div>
                    <div class="menu-item">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="logo">ZØRA</div>
        </div>

        <div class="history-popup" id="historyPopup">
            <div class="popup-header">
                <div class="popup-title">History</div>
                <button class="clear-button" id="clearHistory">Clear History</button>
            </div>
            <div class="history-list" id="historyList"></div>
        </div>

        <div class="bookmarks-popup" id="bookmarksPopup">
            <div class="popup-header">
                <div class="popup-title">Bookmarks</div>
                <button class="bookmark-button" id="addBookmark">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            <div class="bookmarks-list" id="bookmarksList"></div>
        </div>

        <div class="bottom-bar">
            <div class="battery-indicator">
                <div class="battery-icon">
                    <div class="battery-level" id="batteryLevel"></div>
                </div>
                <span id="batteryText">100%</span>
            </div>
            <div class="app-launcher-button">
                <div class="launcher-circle"></div>
            </div>
        </div>

        <div class="app-drawer" id="appDrawer">
            <!-- Your existing app drawer content -->
        </div>

        <div id="context-menu">
            <div class="item">View</div>
            <div class="item">Refresh</div>
            <div class="item">Copy</div>
            <div class="item">Customize</div>
            <div class="item">Save As</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tabBar = document.getElementById('tabBar');
            const newTabBtn = document.querySelector('.new-tab-btn');
            const searchInput = document.querySelector('.search-input');
            const content = document.querySelector('.content');
            const logo = document.querySelector('.logo');
            let activeTab = null;
            let tabs = new Map(); // Store tab data: Map(tabElement => {url, title, content})

            function createTab() {
                const tab = document.createElement('div');
                tab.className = 'tab';
                tab.innerHTML = `
                    <span>New Tab</span>
                    <div class="close-tab">×</div>
                `;
                
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                tabBar.insertBefore(tab, newTabBtn);
                
                // Store tab data
                tabs.set(tab, {
                    url: '',
                    title: 'New Tab',
                    content: null
                });
                
                activeTab = tab;
                
                // Reset search input and show logo for new tab
                searchInput.value = '';
                showNewTabContent();

                const closeBtn = tab.querySelector('.close-tab');
                closeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    // Remove tab data
                    tabs.delete(tab);
                    tab.remove();
                    
                    // If this was the active tab, activate the last remaining tab
                    if (tab === activeTab) {
                        const remainingTabs = document.querySelectorAll('.tab');
                        if (remainingTabs.length > 0) {
                            activateTab(remainingTabs[remainingTabs.length - 1]);
                        } else {
                            createTab(); // Create new tab if none left
                        }
                    }
                });

                tab.addEventListener('click', () => {
                    activateTab(tab);
                });
            }

            function activateTab(tab) {
                // Remove active class from all tabs
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                activeTab = tab;

                // Restore tab's content
                const tabData = tabs.get(tab);
                if (tabData.url) {
                    searchInput.value = tabData.url;
                    content.innerHTML = '';
                    if (tabData.content) {
                        content.appendChild(tabData.content);
                    }
                } else {
                    searchInput.value = '';
                    showNewTabContent();
                }
            }

            function showNewTabContent() {
                content.innerHTML = '';
                logo.style.display = 'block';
                content.appendChild(logo);
            }

            // Search functionality
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && activeTab) {
                    const input = searchInput.value.trim();
                    if (input) {
                        const isUrl = input.includes('.') && !input.includes(' ');
                        let url;
                        let tabTitle;
                        
                        if (isUrl) {
                            url = input.startsWith('http') ? input : `https://${input}`;
                            tabTitle = new URL(url).hostname;
                        } else {
                            url = `https://duckduckgo.com/?q=${encodeURIComponent(input)}`;
                            tabTitle = `${input} - DuckDuckGo`;
                        }
                        
                        const proxyUrl = `https://thisunblockzone.github.io/active/iframe.html#${url}`;
                        
                        // Update tab title and data
                        activeTab.querySelector('span').textContent = tabTitle;
                        
                        // Create and store iframe
                        const iframe = document.createElement('iframe');
                        iframe.style.width = '100%';
                        iframe.style.height = '100%';
                        iframe.style.border = 'none';
                        iframe.src = proxyUrl;
                        
                        content.innerHTML = '';
                        content.appendChild(iframe);
                        
                        // Update tab data
                        tabs.set(activeTab, {
                            url: input,
                            title: tabTitle,
                            content: iframe
                        });

                        logo.style.display = 'none';
                        
                        // Add to history
                        addToHistory(url, tabTitle);
                    }
                }
            });

            // Create initial tab
            createTab();

            // Navigation buttons functionality
            const backBtn = document.getElementById('backBtn');
            const forwardBtn = document.getElementById('forwardBtn');
            const refreshBtn = document.getElementById('refreshBtn');

            backBtn.addEventListener('click', () => {
                const tabData = tabs.get(activeTab);
                if (tabData && tabData.content) {
                    tabData.content.contentWindow.history.back();
                }
            });

            forwardBtn.addEventListener('click', () => {
                const tabData = tabs.get(activeTab);
                if (tabData && tabData.content) {
                    tabData.content.contentWindow.history.forward();
                }
            });

            refreshBtn.addEventListener('click', () => {
                const tabData = tabs.get(activeTab);
                if (tabData && tabData.content) {
                    tabData.content.contentWindow.location.reload();
                }
            });

            // Initialize other features
            initializeInspector();
            initializeFullscreen();
            initializeOptionsMenu();
            initializeAppDrawer();
            initializeBattery();
            initializeContextMenu();
        });

        // Your existing initialization functions remain the same
        function initializeInspector() {
            const inspectBtn = document.getElementById('inspectBtn');
            let isInspectorActive = false;

            inspectBtn.addEventListener('click', () => {
                if (!isInspectorActive) {
                    eruda.init();
                    isInspectorActive = true;
                    inspectBtn.style.background = 'rgba(138, 43, 226, 0.6)';
                } else {
                    eruda.destroy();
                    isInspectorActive = false;
                    inspectBtn.style.background = 'rgba(138, 43, 226, 0.2)';
                }
            });
        }

        function initializeFullscreen() {
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            
            fullscreenBtn.addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                        fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
                    }
                }
            });
        }

        function initializeOptionsMenu() {
            const optionsBtn = document.getElementById('optionsBtn');
            const optionsMenu = document.getElementById('optionsMenu');

            optionsBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                optionsMenu.classList.toggle('active');
            });

            document.addEventListener('click', (e) => {
                if (!optionsMenu.contains(e.target) && !optionsBtn.contains(e.target)) {
                    optionsMenu.classList.remove('active');
                }
            });
        }

        function initializeAppDrawer() {
            const appLauncher = document.querySelector('.app-launcher-button');
            const appDrawer = document.getElementById('appDrawer');

            appLauncher.addEventListener('click', () => {
                appDrawer.classList.toggle('active');
                appLauncher.classList.toggle('active');
            });

            document.addEventListener('click', (e) => {
                if (!appDrawer.contains(e.target) && !appLauncher.contains(e.target)) {
                    appDrawer.classList.remove('active');
                    appLauncher.classList.remove('active');
                }
            });
        }

        function initializeBattery() {
            if ('getBattery' in navigator) {
                navigator.getBattery().then(battery => {
                    function updateBattery() {
                        const level = battery.level * 100;
                        const batteryLevel = document.getElementById('batteryLevel');
                        const batteryText = document.getElementById('batteryText');
                        
                        batteryLevel.style.width = `${level}%`;
                        batteryText.textContent = `${Math.round(level)}%`;

                        if (level <= 20) {
                            batteryLevel.style.background = '#ff4444';
                        } else if (level <= 50) {
                            batteryLevel.style.background = '#ffaa00';
                        } else {
                            batteryLevel.style.background = '#4CAF50';
                        }
                    }

                    battery.addEventListener('levelchange', updateBattery);
                    updateBattery();
                });
            }
        }

        function initializeContextMenu() {
            const contextMenu = document.getElementById('context-menu');

            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                const mouseX = e.clientX;
                const mouseY = e.clientY;
                const menuHeight = contextMenu.getBoundingClientRect().height;
                const menuWidth = contextMenu.getBoundingClientRect().width;
                const width = window.innerWidth;
                const height = window.innerHeight;

                contextMenu.style.left = width - mouseX <= 200 ? 
                    `${width - menuWidth}px` : `${mouseX}px`;
                contextMenu.style.top = height - mouseY <= 200 ? 
                    `${mouseY - menuHeight}px` : `${mouseY}px`;
                contextMenu.style.visibility = 'visible';
            });

            document.addEventListener('click', (e) => {
                if (!contextMenu.contains(e.target)) {
                    contextMenu.style.visibility = 'hidden';
                }
            });
        }

        // History management
        let browserHistory = [];
        
        function addToHistory(url, title) {
            browserHistory.unshift({
                url,
                title: title || url,
                timestamp: new Date().getTime()
            });
            updateHistoryList();
            localStorage.setItem('browserHistory', JSON.stringify(browserHistory));
        }

        function updateHistoryList() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = browserHistory.map(item => `
                <div class="history-item">
                    <i class="fas fa-clock item-icon"></i>
                    <div class="item-details">
                        <div class="item-title">${item.title}</div>
                        <div class="item-url">${item.url}</div>
                    </div>
                    <button class="remove-button" onclick="removeFromHistory('${item.timestamp}')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }

        // Load saved history
        const savedHistory = localStorage.getItem('browserHistory');
        if (savedHistory) {
            browserHistory = JSON.parse(savedHistory);
            updateHistoryList();
        }
    </script>
</body>
</html>
