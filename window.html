

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows Interface</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            height: 100vh;
            background-image: url('https://images.unsplash.com/photo-1673526759327-54f1f5b27322?fm=jpg&q=60&w=3000&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1yZWxhdGVkfDE0fHx8ZW58MHx8fHx8');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
        }

        .desktop-icons {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 15px;
            padding: 15px;
            position: relative;
            z-index: 1;
        }

        .app-icon {
            width: 70px;
            height: 90px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 10px;
            border-radius: 8px;
            animation: fadeInUp 0.5s ease backwards;
        }

        .app-icon:nth-child(1) { animation-delay: 0.1s; }
        .app-icon:nth-child(2) { animation-delay: 0.2s; }
        .app-icon:nth-child(3) { animation-delay: 0.3s; }
        .app-icon:nth-child(4) { animation-delay: 0.4s; }
        .app-icon:nth-child(5) { animation-delay: 0.5s; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .icon-img {
            width: 45px;
            height: 45px;
            background: linear-gradient(45deg, #4B0082, #800080);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .app-icon:hover .icon-img {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(138, 43, 226, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .icon-text {
            color: white;
            font-size: 12px;
            text-align: center;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: rgba(20, 20, 20, 0.85);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .app-launcher-button {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(138, 43, 226, 0.3);
            cursor: pointer;
            margin-right: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .app-launcher-button:hover {
            background: rgba(138, 43, 226, 0.5);
            transform: scale(1.1);
        }

        .launcher-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            position: relative;
            overflow: hidden;
        }

        .launcher-circle::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(138, 43, 226, 0.8), rgba(75, 0, 130, 0.8));
            opacity: 0;
            transition: all 0.3s ease;
        }

        .app-launcher-button:hover .launcher-circle::before {
            opacity: 1;
        }

        .taskbar-icons {
            display: flex;
            gap: 10px;
        }

        .taskbar-icon {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .taskbar-icon[data-app="browser"] {
            background: linear-gradient(45deg, #4B0082, #800080);
            box-shadow: 0 2px 8px rgba(138, 43, 226, 0.3);
        }

        .taskbar-icon:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .taskbar-icon[data-app="browser"].active {
            background: linear-gradient(45deg, #800080, #4B0082);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
        }

        .browser-window {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90vw;
            height: 85vh;
            background: rgba(30, 30, 30, 0.95);
            border-radius: 12px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .browser-window.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            visibility: visible;
        }

        .browser-window.maximized {
            width: 100vw !important;
            height: calc(100vh - 50px) !important;
            top: 0 !important;
            left: 0 !important;
            transform: none !important;
            border-radius: 0;
        }

        .browser-window.minimized {
            transform: translate(-50%, 100vh) scale(0.5);
            opacity: 0;
            visibility: hidden;
        }

        .browser-header {
            height: 40px;
            background: rgba(40, 40, 40, 0.95);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 15px;
            border-bottom: 1px solid rgba(138, 43, 226, 0.3);
            cursor: move;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .control-button {
            width: 35px;
            height: 35px;
            border: none;
            background: transparent;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .control-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .control-button.close:hover {
            background: rgba(255, 0, 0, 0.2);
        }

        .control-button.maximize:hover,
        .control-button.minimize:hover {
            background: rgba(138, 43, 226, 0.2);
        }

        .browser-content {
            height: calc(100% - 40px);
        }

        .browser-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        

.browser-window {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90vw;
    height: 85vh;
    background: rgba(30, 30, 30, 0.95);
    border-radius: 12px;
    overflow: hidden;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(138, 43, 226, 0.3);
}

.browser-content {
    height: calc(100% - 40px);
    position: relative;
    z-index: 1;
    pointer-events: auto;
}

.browser-content iframe {
    width: 100%;
    height: 100%;
    border: none;
    pointer-events: auto;
}

.browser-header {
    position: relative;
    z-index: 2;
}

/* Make desktop icons stay behind browser window */
.desktop-icons {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 15px;
    padding: 15px;
    position: relative;
    z-index: 1;
}

/* Make browser window appear above desktop icons but below taskbar */
.browser-window {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90vw;
    height: 85vh;
    background: rgba(30, 30, 30, 0.95);
    border-radius: 12px;
    overflow: hidden;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(138, 43, 226, 0.3);
    z-index: 1000; /* Add this line */
}

/* Make taskbar stay on top */
.taskbar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 50px;
    background: rgba(20, 20, 20, 0.85);
    backdrop-filter: blur(15px);
    display: flex;
    align-items: center;
    padding: 0 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 2000; /* Add this line */
}

.browser-window.active {
    opacity: 1;
    visibility: visible;
}

/* App Window Styles */
.app-window {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    width: 90vw;
    height: 85vh;
    background: rgba(30, 30, 30, 0.95);
    border-radius: 12px;
    overflow: hidden;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(138, 43, 226, 0.3);
    z-index: 1000;
}

.window-header {
    height: 40px;
    background: rgba(40, 40, 40, 0.95);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 15px;
    border-bottom: 1px solid rgba(138, 43, 226, 0.3);
    cursor: move;
}

.window-title {
    color: white;
    font-size: 14px;
    font-weight: 600;
}

.window-content {
    height: calc(100% - 40px);
    position: relative;
}

.window-content iframe {
    width: 100%;
    height: 100%;
    border: none;
}

/* App Store Styles */
.store-content {
    padding: 20px;
    overflow-y: auto;
}

.app-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    padding: 20px;
}

.store-app {
    background: rgba(40, 40, 40, 0.95);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 20px;
    transition: all 0.3s ease;
}

.store-app:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(138, 43, 226, 0.2);
}

.store-app img {
    width: 80px;
    height: 80px;
    border-radius: 12px;
}

.app-info {
    flex: 1;
}

.app-info h3 {
    color: white;
    margin-bottom: 5px;
}

.app-info p {
    color: rgba(255, 255, 255, 0.7);
    font-size: 14px;
    margin-bottom: 10px;
}

.install-btn {
    background: rgba(138, 43, 226, 0.3);
    border: none;
    color: white;
    padding: 8px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.install-btn:hover {
    background: rgba(138, 43, 226, 0.5);
}

.installed {
    background: rgba(76, 175, 80, 0.3) !important;
}

/* Add to your existing CSS */
.browser-window, .app-window {
    resize: both;
    min-width: 400px;
    min-height: 300px;
}

.resize-handle {
    position: absolute;
    width: 10px;
    height: 10px;
    background: rgba(138, 43, 226, 0.3);
    border-radius: 50%;
    cursor: se-resize;
    bottom: 0;
    right: 0;
    z-index: 1001;
}

.window-header {
    user-select: none;
}

.app-window.active {
  display: flex;
  flex-direction: column;
}

.install-btn {
    background: rgba(138, 43, 226, 0.3);
    border: none;
    color: white;
    padding: 8px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.install-btn.remove-btn {
    background: rgba(255, 0, 0, 0.3);
}

.install-btn:hover {
    background: rgba(138, 43, 226, 0.5);
}

.install-btn.remove-btn:hover {
    background: rgba(255, 0, 0, 0.5);
}

.control-button {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  margin-left: 5px;
  font-size: 14px;
}

.control-button:hover {
  color: #8a2be2;
}

.resize-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  bottom: 0;
  right: 0;
  background: rgba(138, 43, 226, 0.5);
  cursor: nwse-resize;
  border-radius: 2px;
}

.browser-window,
.app-window {
  transition: all 0.3s ease-in-out !important;
  transform-origin: center;
}

.browser-window.fullscreen {
  border-radius: 0;
  transition: all 0.4s ease;
}

.control-button {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  margin-left: 5px;
  font-size: 14px;
  padding: 4px;
}

.control-button:hover {
  color: #8a2be2;
}

.resize-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  bottom: 0;
  right: 0;
  background: rgba(138, 43, 226, 0.5);
  cursor: nwse-resize;
  border-radius: 3px;
}


/* Update the desktop-icons class in the CSS */
.desktop-icons {
    display: grid;
    grid-template-columns: repeat(6, 1fr); /* 6 icons per row */
    gap: 15px;
    padding: 15px;
    position: relative;
    z-index: 1;
    max-height: calc(100vh - 70px); /* Prevent icons from going below taskbar */
    overflow-y: auto; /* Allow scrolling if many icons */
    grid-auto-flow: row; /* Create new rows as needed */
    width: 100%;
    align-content: start; /* Start from the top */
}

/* Add styles for better icon organization */
.app-icon {
    width: calc((100vw - 120px) / 6); /* Distribute space evenly */
    max-width: 100px; /* Maximum width for icons */
    min-width: 70px; /* Minimum width for icons */
    justify-self: center; /* Center icons in their grid cells */
}

/* Update the desktop-icons class */
.desktop-icons {
    display: flex;
    flex-direction: column;
    gap: 15px;
    padding: 15px;
    position: fixed; /* Change to fixed */
    left: 0;
    top: 0;
    z-index: 1;
    height: calc(100vh - 50px); /* Account for taskbar */
    overflow: hidden; /* Prevent scrolling */
    width: 100px; /* Fixed width for the column */
}

/* Update the app-icon class */
.app-icon {
    width: 70px;
    height: 90px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 10px;
    border-radius: 8px;
    animation: fadeInUp 0.5s ease backwards;
    flex-shrink: 0; /* Prevent icons from shrinking */
}

/* Update icon image container */
.icon-img {
    width: 45px;
    height: 45px;
    background: linear-gradient(45deg, #4B0082, #800080);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    color: white;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Update icon text */
.icon-text {
    color: white;
    font-size: 12px;
    text-align: center;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Ensure browser windows don't interfere with icons */
.browser-window {
    margin-left: 100px; /* Add margin to avoid overlapping with icons */
    width: calc(90vw - 100px); /* Adjust width to account for icon space */
}

/* Update maximized window state to account for icon space */
.browser-window.maximized {
    margin-left: 100px;
    width: calc(100vw - 100px) !important;
}

    </style>
</head>
<body>
    <div class="desktop-icons">
        <div class="app-icon" data-app="browser">
            <div class="icon-img"><i class="fas fa-globe"></i></div>
            <span class="icon-text">Browser</span>
        </div>
        <div class="app-icon"><div class="icon-img"><i class="fas fa-folder"></i></div><span class="icon-text">Files</span></div>
        <div class="app-icon"><div class="icon-img"><i class="fas fa-cog"></i></div><span class="icon-text">Settings</span></div>

<div class="app-icon" data-app="spotify">
    <div class="icon-img"><i class="fab fa-spotify"></i></div>
    <span class="icon-text">Spotify</span>
</div>
<div class="app-icon" data-app="store">
    <div class="icon-img"><i class="fas fa-store"></i></div>
    <span class="icon-text">Store</span>
</div>


    <div class="browser-window" id="browserWindow">
        <div class="browser-header">
            <div class="window-controls">
                <button class="control-button minimize" title="Minimize"><i class="fas fa-minus"></i></button>
                <button class="control-button maximize" title="Maximize"><i class="fas fa-square"></i></button>
                <button class="control-button close" title="Close"><i class="fas fa-times"></i></button>
            </div>
        </div>
        <div class="browser-content">
            <iframe src="https://thisunblockzone.github.io/zora/"></iframe>
        </div>
    </div>

    <div class="taskbar">
        <div class="app-launcher-button"><div class="launcher-circle"></div></div>
<div class="taskbar-icons">
  <div class="taskbar-icon" data-app="browser"><i class="fas fa-globe"></i></div>
  <div class="taskbar-icon" data-app="files"><i class="fas fa-folder"></i></div>
  <div class="taskbar-icon" data-app="settings"><i class="fas fa-cog"></i></div>
  <div class="taskbar-icon" data-app="spotify"><i class="fab fa-spotify"></i></div>
  <div class="taskbar-icon" data-app="store"><i class="fas fa-store"></i></div>
</div>
</i></div>

        </div>
    </div>
    
    <!-- Spotify Window -->
<div class="browser-window" id="spotifyWindow">
        <div class="browser-header">
            <div class="window-controls">
                <button class="control-button minimize" title="Minimize"><i class="fas fa-minus"></i></button>
                <button class="control-button maximize" title="Maximize"><i class="fas fa-square"></i></button>
                <button class="control-button close" title="Close"><i class="fas fa-times"></i></button>
            </div>
        </div>
        <div class="browser-content">
            <iframe src="https://spotfy.one/"></iframe>
        </div>
    </div>


<!-- App Store Window -->
<div class="browser-window" id="storeWindow">
    <div class="window-header">
        <div class="window-title">App Store</div>
        <div class="window-controls">
            <button class="control-button minimize" title="Minimize"><i class="fas fa-minus"></i></button>
            <button class="control-button maximize" title="Maximize"><i class="fas fa-square"></i></button>
            <button class="control-button close" title="Close"><i class="fas fa-times"></i></button>
        </div>
    </div>
    <div class="window-content store-content">
        <div class="app-grid">
            <div class="store-app" data-app="geforcenow">
                <img src="https://play-lh.googleusercontent.com/Kf8WTct65hFJxBUDm51uPIIc7LKQNQpGmLHTJFqKWPuqNxkZ8A9L1xRT0uW2bE_f_w=w240-h480-rw" alt="GeForce Now">
                <div class="app-info">
                    <h3>GeForce Now</h3>
                    <p>Cloud Gaming Platform</p>
                    <button class="install-btn">Install</button>
                </div>
            </div>
            <div class="store-app" data-app="tiktok">
                <img src="https://play-lh.googleusercontent.com/OS-MhSWOPtlUZLt0_UP5TI4juSf0XhyHxGfJa6JrR-64UcOqV5UxCF0C5_OVlYmyEJg=w240-h480-rw" alt="TikTok">
                <div class="app-info">
                    <h3>TikTok</h3>
                    <p>Short-form Videos</p>
                    <button class="install-btn">Install</button>
                </div>
            </div>
            <div class="store-app" data-app="poki">
                <img src="https://play-lh.googleusercontent.com/DTzWtkxfnKwFO3ruybY1SKjJQnLYeuK3KmQmwV5OQ3dULr5iXxeEtzBLceultrKTIUTr=w240-h480-rw" alt="Poki">
                <div class="app-info">
                    <h3>Poki</h3>
                    <p>Online Games</p>
                    <button class="install-btn">Install</button>
                </div>
            </div>
        </div>
    </div>
</div>


    <script>

document.addEventListener("DOMContentLoaded", () => {
    // Constants
    const CORE_APPS = ['browser', 'files', 'settings', 'spotify', 'store'];
    
    // Window elements
    const windows = {
        browser: document.getElementById("browserWindow"),
        spotify: document.getElementById("spotifyWindow"),
        store: document.getElementById("storeWindow")
    };

    // Track window states
    const windowStates = {};
    let zIndexCounter = 1000;
    let activeWindow = null;

    // Initialize window states
    Object.keys(windows).forEach(appName => {
        windowStates[appName] = {
            isActive: false,
            isMaximized: false,
            isDragging: false,
            zIndex: zIndexCounter++
        };
    });

    function bringToFront(windowElement) {
        const newZ = ++zIndexCounter;
        windowElement.style.zIndex = newZ;
        Array.from(document.querySelectorAll('.browser-window')).forEach(win => {
            if (win !== windowElement) {
                win.style.zIndex = Math.min(parseInt(win.style.zIndex || 1000), newZ - 1);
        const newZ = ++zIndexCounter;
        windowElement.style.zIndex = newZ;
        Array.from(document.querySelectorAll('.browser-window')).forEach(win => {
            if (win !== windowElement) {
                win.style.zIndex = Math.min(parseInt(win.style.zIndex || 1000), newZ - 1);
            }
        });
    }

    // Dragging functionality
    function makeDraggable(windowEl) {
        const header = windowEl.querySelector('.browser-header, .window-header');
    // Dragging functionality
    function makeDraggable(windowEl) {
        const header = windowEl.querySelector('.browser-header, .window-header');
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;
        let xOffset = 0;
        let yOffset = 0;

        header.addEventListener('mousedown', (e) => {
            if (e.target.closest('.window-controls')) return;
            if (windowEl.classList.contains('maximized')) return;
        header.addEventListener('mousedown', (e) => {
            if (e.target.closest('.window-controls')) return;
            if (windowEl.classList.contains('maximized')) return;

            isDragging = true;
            windowEl.style.transition = 'none';
            
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;
            windowEl.style.transition = 'none';
            
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;

            if (windowEl.classList.contains('active')) {
                bringToFront(windowEl);
            }
        });

        document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

            e.preventDefault();

                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

            xOffset = currentX;
            yOffset = currentY;

                // Constrain to viewport
            const maxX = window.innerWidth - windowEl.offsetWidth;
            const maxY = window.innerHeight - windowEl.offsetHeight - 50;
                currentX = Math.min(Math.max(0, currentX), maxX);
                currentY = Math.min(Math.max(0, currentY), maxY);

            windowEl.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
        });
            windowEl.style.transform = `translate3d(${currentX}px, ${currentY}px, 0)`;
        });

        document.addEventListener('mouseup', () => {
            if (!isDragging) return;
            
                isDragging = false;
            windowEl.style.transition = '';
            
            // Update final position
            const finalX = parseInt(windowEl.style.transform.split('(')[1]);
            const finalY = parseInt(windowEl.style.transform.split(',')[1]);
            windowEl.style.left = `${finalX}px`;
            windowEl.style.top = `${finalY}px`;
            windowEl.style.transform = 'none';
        });
    }

    // Window Control Functions
    function initializeWindowControls(window, appName) {
        const controls = window.querySelector('.window-controls');
        if (!controls) return;

        controls.querySelector('.close').addEventListener('click', () => {
            window.classList.remove('active');
            window.style.display = 'none';
            windowStates[appName].isOpen = false;
            window.style.display = 'none';
            windowStates[appName].isOpen = false;
        });

        controls.querySelector('.minimize').addEventListener('click', () => {
            window.classList.add('minimized');
            window.classList.remove('active');
            windowStates[appName].isMinimized = true;
            windowStates[appName].isMinimized = true;
        });

        controls.querySelector('.maximize').addEventListener('click', () => {
            window.classList.toggle('maximized');
            if (window.classList.contains('maximized')) {
                window.style.transform = 'none';
                window.style.top = '0';
                window.style.left = '0';
                window.style.transform = 'none';
                window.style.top = '0';
                window.style.left = '0';
                window.style.width = '100vw';
                window.style.height = 'calc(100vh - 50px)';
                window.style.borderRadius = '0';
                window.style.borderRadius = '0';
            } else {
                window.style.width = '90vw';
                window.style.height = '85vh';
                window.style.borderRadius = '12px';
                window.style.top = '50%';
                window.style.left = '50%';
                window.style.transform = 'translate(-50%, -50%)';
                window.style.width = '90vw';
                window.style.height = '85vh';
                window.style.borderRadius = '12px';
                window.style.top = '50%';
                window.style.left = '50%';
                window.style.transform = 'translate(-50%, -50%)';
            }
        });
    }

    // Initialize existing windows
    Object.keys(windows).forEach(appName => {
        const window = windows[appName];
        if (window) {
            initializeWindowControls(window, appName);
            makeDraggable(window);
        }
    });
    // Initialize existing windows
    Object.keys(windows).forEach(appName => {
        const window = windows[appName];
        if (window) {
            initializeWindowControls(window, appName);
            makeDraggable(window);
        }
    });

    // App Store Installation
    document.querySelectorAll('.install-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const appContainer = btn.closest('.store-app');
        const appId = appContainer.dataset.app;
            const title = appContainer.querySelector('h3').textContent;
            const iconUrl = appContainer.querySelector('img').src;

        if (btn.classList.contains('remove-btn')) {
            // Remove app
            const icon = document.querySelector(`.app-icon[data-app="${appId}"]`);
            const win = windows[appId];
            if (icon) icon.remove();
            if (win) win.remove();
            delete windows[appId];
                
                btn.innerHTML = `<i class="fas fa-download"></i> Install`;
                btn.classList.remove('remove-btn');
            
            // Update localStorage
            const installedApps = JSON.parse(localStorage.getItem('installedApps') || '[]');
            const updatedApps = installedApps.filter(app => app !== appId);
            localStorage.setItem('installedApps', JSON.stringify(updatedApps));
            } else {
                // Install app
                createNewWindow(appId, title, getAppUrl(appId));
                
                btn.innerHTML = `<i class="fas fa-trash"></i> Remove`;
                btn.classList.add('remove-btn');
                
                // Save to localStorage
                const installedApps = JSON.parse(localStorage.getItem('installedApps') || '[]');
                if (!installedApps.includes(appId)) {
                    installedApps.push(appId);
                    localStorage.setItem('installedApps', JSON.stringify(installedApps));
                }
            }
        });
    });

    // Window Creation and Management
    function createNewWindow(appId, title, url) {
        const windowId = `${appId}Window`;
        let windowEl = document.getElementById(windowId);
        
        if (!windowEl) {
            windowEl = document.createElement('div');
            windowEl.id = windowId;
            windowEl.className = 'browser-window';
            windowEl.innerHTML = `
            <div class="browser-header">
                    <div class="window-title">${title}</div>
                <div class="window-controls">
                        <button class="control-button minimize"><i class="fas fa-minus"></i></button>
                        <button class="control-button maximize"><i class="fas fa-square"></i></button>
                        <button class="control-button close"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div class="browser-content">
                    <iframe src="${url}"></iframe>
            </div>
                <div class="resize-handle"></div>
            `;
            
            document.body.appendChild(windowEl);
            windows[appId] = windowEl;
            windowStates[appId] = {
                isActive: true,
                isMaximized: false,
                isDragging: false,
                zIndex: ++zIndexCounter
            };

            // Create desktop icon
            createDesktopIcon(appId, title, url);
            
            // Initialize window controls
            initializeWindowControls(windowEl, appId);
            makeDraggable(windowEl);
            initializeResize(windowEl);
        }

        openWindow(windowEl);
        return windowEl;
    }

    function createDesktopIcon(appId, title, iconUrl) {
        const desktopIcons = document.querySelector(".desktop-icons");
        const existingIcon = document.querySelector(`.app-icon[data-app="${appId}"]`);
        
        if (!existingIcon) {
            const newIcon = document.createElement("div");
            newIcon.className = "app-icon";
            newIcon.dataset.app = appId;
            newIcon.innerHTML = `
                <div class="icon-img">
                    <img src="${iconUrl}" style="width: 100%; height: 100%; border-radius: 10px;">
                </div>
                <span class="icon-text">${title}</span>
            `;
            
            desktopIcons.appendChild(newIcon);
            
            // Add click handler
            newIcon.addEventListener("click", () => {
                const win = windows[appId];
                if (win) {
                    openWindow(win);

        openWindow(windowEl);
        return windowEl;
    }

    function createDesktopIcon(appId, title, iconUrl) {
        const desktopIcons = document.querySelector(".desktop-icons");
        const existingIcon = document.querySelector(`.app-icon[data-app="${appId}"]`);
        
        if (!existingIcon) {
            const newIcon = document.createElement("div");
            newIcon.className = "app-icon";
            newIcon.dataset.app = appId;
            newIcon.innerHTML = `
                <div class="icon-img">
                    <img src="${iconUrl}" style="width: 100%; height: 100%; border-radius: 10px;">
                </div>
                <span class="icon-text">${title}</span>
            `;
            
            desktopIcons.appendChild(newIcon);
            
            // Add click handler
            newIcon.addEventListener("click", () => {
                const win = windows[appId];
                if (win) {
                    openWindow(win);
                } else {
                    createNewWindow(appId, title, getAppUrl(appId));
                    createNewWindow(appId, title, getAppUrl(appId));
                }
            });
        }
    }
    }

    function initializeResize(windowEl) {
        const resizeHandle = windowEl.querySelector('.resize-handle');
        if (!resizeHandle) return;

        let isResizing = false;
        let startX, startY, startWidth, startHeight;

        resizeHandle.addEventListener('mousedown', (e) => {
            isResizing = true;
            startX = e.clientX;
            startY = e.clientY;
            startWidth = windowEl.offsetWidth;
            startHeight = windowEl.offsetHeight;
            bringToFront(windowEl);

            document.addEventListener('mousemove', resizeMove);
            document.addEventListener('mouseup', resizeEnd);
        });

        function resizeMove(e) {
            if (!isResizing) return;

            const newWidth = startWidth + (e.clientX - startX);
            const newHeight = startHeight + (e.clientY - startY);

            if (newWidth >= 400) windowEl.style.width = newWidth + 'px';
            if (newHeight >= 300) windowEl.style.height = newHeight + 'px';
        }

        function resizeEnd() {
            isResizing = false;
            document.removeEventListener('mousemove', resizeMove);
            document.removeEventListener('mouseup', resizeEnd);
    function initializeResize(windowEl) {
        const resizeHandle = windowEl.querySelector('.resize-handle');
        if (!resizeHandle) return;

        let isResizing = false;
        let startX, startY, startWidth, startHeight;

        resizeHandle.addEventListener('mousedown', (e) => {
            isResizing = true;
            startX = e.clientX;
            startY = e.clientY;
            startWidth = windowEl.offsetWidth;
            startHeight = windowEl.offsetHeight;
            bringToFront(windowEl);

            document.addEventListener('mousemove', resizeMove);
            document.addEventListener('mouseup', resizeEnd);
        });

        function resizeMove(e) {
            if (!isResizing) return;

            const newWidth = startWidth + (e.clientX - startX);
            const newHeight = startHeight + (e.clientY - startY);

            if (newWidth >= 400) windowEl.style.width = newWidth + 'px';
            if (newHeight >= 300) windowEl.style.height = newHeight + 'px';
        }

        function resizeEnd() {
            isResizing = false;
            document.removeEventListener('mousemove', resizeMove);
            document.removeEventListener('mouseup', resizeEnd);
        }
    }

    function openWindow(windowEl) {
        if (!windowEl) return;
        
        windowEl.style.display = 'block';
        windowEl.classList.remove('minimized');
        windowEl.classList.add('active');
        
        const appId = windowEl.id.replace('Window', '');
        if (windowStates[appId]) {
            windowStates[appId].isMinimized = false;
            windowStates[appId].isOpen = true;
        }
        
        bringToFront(windowEl);
    }

    // Desktop and Taskbar Icon Management
    function initializeIconHandlers() {
        // Desktop Icons
        document.querySelectorAll('.app-icon').forEach(icon => {
            const appId = icon.dataset.app;
            if (!appId) return;

            icon.addEventListener('click', () => {
                const win = windows[appId];
                if (win) {
                    openWindow(win);
                } else {
                    const title = icon.querySelector('.icon-text').textContent;
                    createNewWindow(appId, title, getAppUrl(appId));
                }
            });
        });

        // Taskbar Icons
        document.querySelectorAll('.taskbar-icon').forEach(icon => {
            const appId = icon.dataset.app;
            if (!appId) return;

    }

    function openWindow(windowEl) {
        if (!windowEl) return;
        
        windowEl.style.display = 'block';
        windowEl.classList.remove('minimized');
        windowEl.classList.add('active');
        
        const appId = windowEl.id.replace('Window', '');
        if (windowStates[appId]) {
            windowStates[appId].isMinimized = false;
            windowStates[appId].isOpen = true;
        }
        
        bringToFront(windowEl);
    }

    // Desktop and Taskbar Icon Management
    function initializeIconHandlers() {
        // Desktop Icons
        document.querySelectorAll('.app-icon').forEach(icon => {
            const appId = icon.dataset.app;
            if (!appId) return;

            icon.addEventListener('click', () => {
                const win = windows[appId];
                if (win) {
                    openWindow(win);
                } else {
                    const title = icon.querySelector('.icon-text').textContent;
                    createNewWindow(appId, title, getAppUrl(appId));
                }
            });
        });

        // Taskbar Icons
        document.querySelectorAll('.taskbar-icon').forEach(icon => {
            const appId = icon.dataset.app;
            if (!appId) return;

            icon.addEventListener('click', () => {
                const win = windows[appId];
                if (!win) return;

                const win = windows[appId];
                if (!win) return;

                if (win.classList.contains('minimized')) {
                    openWindow(win);
                    openWindow(win);
                } else if (win.classList.contains('active')) {
                    win.classList.add('minimized');
                    win.classList.remove('active');
                } else {
                    openWindow(win);
                    openWindow(win);
                }
            });
        });
    }

    // Load installed apps on startup
    function loadInstalledApps() {
        const installedApps = JSON.parse(localStorage.getItem('installedApps') || '[]');
        installedApps.forEach(appId => {
            const storeApp = document.querySelector(`.store-app[data-app="${appId}"]`);
            if (storeApp) {
                const title = storeApp.querySelector('h3').textContent;
                const iconUrl = storeApp.querySelector('img').src;
                createDesktopIcon(appId, title, iconUrl);
                
                const btn = storeApp.querySelector('.install-btn');
                if (btn) {
                    btn.innerHTML = `<i class="fas fa-trash"></i> Remove`;
                    btn.classList.add('remove-btn');
                }
            }
        });
    }

    // Initialize everything
    initializeIconHandlers();
    loadInstalledApps();

    // Make functions globally available
    window.createNewWindow = createNewWindow;
    window.openWindow = openWindow;
    window.bringToFront = bringToFront;

    // Helper function to get app URLs
    function getAppUrl(appId) {
        const urls = {
            geforcenow: 'https://thisunblockzone.github.io/active/iframe.html#https://play.geforcenow.com',
            tiktok: 'https://thisunblockzone.github.io/active/iframe.html#https://tiktok.com',
            poki: 'https://thisunblockzone.github.io/active/iframe.html#https://poki.com',
            spotify: 'https://spotfy.one/',
            browser: 'https://thisunblockzone.github.io/zora/',
            store: '#'
        };
        return urls[appId] || '#';
    }
});

function createDesktopIcon(appId, title, iconUrl) {
    const desktopIcons = document.querySelector(".desktop-icons");
    const existingIcon = document.querySelector(`.app-icon[data-app="${appId}"]`);
    
    // Check if we've reached the maximum number of visible icons
    const maxIcons = Math.floor((window.innerHeight - 65) / 105); // 105 = icon height + gap
    if (desktopIcons.children.length >= maxIcons && !existingIcon) {
        alert('Maximum number of icons reached. Please remove some apps first.');
        return false;
        });
    }

    // Load installed apps on startup
    function loadInstalledApps() {
        const installedApps = JSON.parse(localStorage.getItem('installedApps') || '[]');
        installedApps.forEach(appId => {
            const storeApp = document.querySelector(`.store-app[data-app="${appId}"]`);
            if (storeApp) {
                const title = storeApp.querySelector('h3').textContent;
                const iconUrl = storeApp.querySelector('img').src;
                createDesktopIcon(appId, title, iconUrl);
                
                const btn = storeApp.querySelector('.install-btn');
                if (btn) {
                    btn.innerHTML = `<i class="fas fa-trash"></i> Remove`;
                    btn.classList.add('remove-btn');
                }
            }
        });
    }

    // Initialize everything
    initializeIconHandlers();
    loadInstalledApps();

    // Make functions globally available
    window.createNewWindow = createNewWindow;
    window.openWindow = openWindow;
    window.bringToFront = bringToFront;

    // Helper function to get app URLs
    function getAppUrl(appId) {
        const urls = {
            geforcenow: 'https://thisunblockzone.github.io/active/iframe.html#https://play.geforcenow.com',
            tiktok: 'https://thisunblockzone.github.io/active/iframe.html#https://tiktok.com',
            poki: 'https://thisunblockzone.github.io/active/iframe.html#https://poki.com',
            spotify: 'https://spotfy.one/',
            browser: 'https://thisunblockzone.github.io/zora/',
            store: '#'
        };
        return urls[appId] || '#';
    }
});

function createDesktopIcon(appId, title, iconUrl) {
    const desktopIcons = document.querySelector(".desktop-icons");
    const existingIcon = document.querySelector(`.app-icon[data-app="${appId}"]`);
    
    // Check if we've reached the maximum number of visible icons
    const maxIcons = Math.floor((window.innerHeight - 65) / 105); // 105 = icon height + gap
    if (desktopIcons.children.length >= maxIcons && !existingIcon) {
        alert('Maximum number of icons reached. Please remove some apps first.');
        return false;
    }
    
    if (!existingIcon) {
        const newIcon = document.createElement("div");
        newIcon.className = "app-icon";
        newIcon.dataset.app = appId;
        newIcon.innerHTML = `
            <div class="icon-img">
                <img src="${iconUrl}" style="width: 100%; height: 100%; border-radius: 10px;">
            </div>
            <span class="icon-text">${title}</span>
        `;
        
        desktopIcons.appendChild(newIcon);
        
        newIcon.addEventListener("click", () => {
            const win = windows[appId];
            if (win) {
                openWindow(win);
    } else {
                createNewWindow(appId, title, getAppUrl(appId));
            }
        });
        
        return true;
    }
    return false;
}

</script>

</body>
</html>
