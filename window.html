

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows Interface</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            height: 100vh;
            background-image: url('https://images.unsplash.com/photo-1673526759327-54f1f5b27322?fm=jpg&q=60&w=3000&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1yZWxhdGVkfDE0fHx8ZW58MHx8fHx8');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
        }

        .desktop-icons {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 15px;
            padding: 15px;
            position: relative;
            z-index: 1;
        }

        .app-icon {
            width: 70px;
            height: 90px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 10px;
            border-radius: 8px;
            animation: fadeInUp 0.5s ease backwards;
        }

        .app-icon:nth-child(1) { animation-delay: 0.1s; }
        .app-icon:nth-child(2) { animation-delay: 0.2s; }
        .app-icon:nth-child(3) { animation-delay: 0.3s; }
        .app-icon:nth-child(4) { animation-delay: 0.4s; }
        .app-icon:nth-child(5) { animation-delay: 0.5s; }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .icon-img {
            width: 45px;
            height: 45px;
            background: linear-gradient(45deg, #4B0082, #800080);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .app-icon:hover .icon-img {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(138, 43, 226, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .icon-text {
            color: white;
            font-size: 12px;
            text-align: center;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: rgba(20, 20, 20, 0.85);
            backdrop-filter: blur(15px);
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .app-launcher-button {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(138, 43, 226, 0.3);
            cursor: pointer;
            margin-right: auto;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .app-launcher-button:hover {
            background: rgba(138, 43, 226, 0.5);
            transform: scale(1.1);
        }

        .launcher-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            position: relative;
            overflow: hidden;
        }

        .launcher-circle::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(138, 43, 226, 0.8), rgba(75, 0, 130, 0.8));
            opacity: 0;
            transition: all 0.3s ease;
        }

        .app-launcher-button:hover .launcher-circle::before {
            opacity: 1;
        }

        .taskbar-icons {
            display: flex;
            gap: 10px;
        }

        .taskbar-icon {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .taskbar-icon[data-app="browser"] {
            background: linear-gradient(45deg, #4B0082, #800080);
            box-shadow: 0 2px 8px rgba(138, 43, 226, 0.3);
        }

        .taskbar-icon:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .taskbar-icon[data-app="browser"].active {
            background: linear-gradient(45deg, #800080, #4B0082);
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.5);
        }

        .browser-window {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90vw;
            height: 85vh;
            background: rgba(30, 30, 30, 0.95);
            border-radius: 12px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(138, 43, 226, 0.3);
        }

        .browser-window.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
            visibility: visible;
        }

        .browser-window.maximized {
            width: 100vw !important;
            height: calc(100vh - 50px) !important;
            top: 0 !important;
            left: 0 !important;
            transform: none !important;
            border-radius: 0;
        }

        .browser-window.minimized {
            transform: translate(-50%, 100vh) scale(0.5);
            opacity: 0;
            visibility: hidden;
        }

        .browser-header {
            height: 40px;
            background: rgba(40, 40, 40, 0.95);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 15px;
            border-bottom: 1px solid rgba(138, 43, 226, 0.3);
            cursor: move;
        }

        .window-controls {
            display: flex;
            gap: 8px;
        }

        .control-button {
            width: 35px;
            height: 35px;
            border: none;
            background: transparent;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .control-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .control-button.close:hover {
            background: rgba(255, 0, 0, 0.2);
        }

        .control-button.maximize:hover,
        .control-button.minimize:hover {
            background: rgba(138, 43, 226, 0.2);
        }

        .browser-content {
            height: calc(100% - 40px);
        }

        .browser-content iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        

.browser-window {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90vw;
    height: 85vh;
    background: rgba(30, 30, 30, 0.95);
    border-radius: 12px;
    overflow: hidden;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(138, 43, 226, 0.3);
}

.browser-content {
    height: calc(100% - 40px);
    position: relative;
    z-index: 1;
    pointer-events: auto;
}

.browser-content iframe {
    width: 100%;
    height: 100%;
    border: none;
    pointer-events: auto;
}

.browser-header {
    position: relative;
    z-index: 2;
}

/* Make desktop icons stay behind browser window */
.desktop-icons {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 15px;
    padding: 15px;
    position: relative;
    z-index: 1;
}

/* Make browser window appear above desktop icons but below taskbar */
.browser-window {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 90vw;
    height: 85vh;
    background: rgba(30, 30, 30, 0.95);
    border-radius: 12px;
    overflow: hidden;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(138, 43, 226, 0.3);
    z-index: 1000; /* Add this line */
}

/* Make taskbar stay on top */
.taskbar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 50px;
    background: rgba(20, 20, 20, 0.85);
    backdrop-filter: blur(15px);
    display: flex;
    align-items: center;
    padding: 0 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    z-index: 2000; /* Add this line */
}

.browser-window.active {
    opacity: 1;
    visibility: visible;
}

/* App Window Styles */
.app-window {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    width: 90vw;
    height: 85vh;
    background: rgba(30, 30, 30, 0.95);
    border-radius: 12px;
    overflow: hidden;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(138, 43, 226, 0.3);
    z-index: 1000;
}

.window-header {
    height: 40px;
    background: rgba(40, 40, 40, 0.95);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 15px;
    border-bottom: 1px solid rgba(138, 43, 226, 0.3);
    cursor: move;
}

.window-title {
    color: white;
    font-size: 14px;
    font-weight: 600;
}

.window-content {
    height: calc(100% - 40px);
    position: relative;
}

.window-content iframe {
    width: 100%;
    height: 100%;
    border: none;
}

/* App Store Styles */
.store-content {
    padding: 20px;
    overflow-y: auto;
}

.app-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
    padding: 20px;
}

.store-app {
    background: rgba(40, 40, 40, 0.95);
    border-radius: 12px;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 20px;
    transition: all 0.3s ease;
}

.store-app:hover {
    transform: translateY(-5px);
    box-shadow: 0 5px 15px rgba(138, 43, 226, 0.2);
}

.store-app img {
    width: 80px;
    height: 80px;
    border-radius: 12px;
}

.app-info {
    flex: 1;
}

.app-info h3 {
    color: white;
    margin-bottom: 5px;
}

.app-info p {
    color: rgba(255, 255, 255, 0.7);
    font-size: 14px;
    margin-bottom: 10px;
}

.install-btn {
    background: rgba(138, 43, 226, 0.3);
    border: none;
    color: white;
    padding: 8px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.install-btn:hover {
    background: rgba(138, 43, 226, 0.5);
}

.installed {
    background: rgba(76, 175, 80, 0.3) !important;
}

/* Add to your existing CSS */
.browser-window, .app-window {
    resize: both;
    min-width: 400px;
    min-height: 300px;
}

.resize-handle {
    position: absolute;
    width: 10px;
    height: 10px;
    background: rgba(138, 43, 226, 0.3);
    border-radius: 50%;
    cursor: se-resize;
    bottom: 0;
    right: 0;
    z-index: 1001;
}

.window-header {
    user-select: none;
}

.app-window.active {
  display: flex;
  flex-direction: column;
}

.install-btn {
    background: rgba(138, 43, 226, 0.3);
    border: none;
    color: white;
    padding: 8px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.install-btn.remove-btn {
    background: rgba(255, 0, 0, 0.3);
}

.install-btn:hover {
    background: rgba(138, 43, 226, 0.5);
}

.install-btn.remove-btn:hover {
    background: rgba(255, 0, 0, 0.5);
}

.control-button {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  margin-left: 5px;
  font-size: 14px;
}

.control-button:hover {
  color: #8a2be2;
}

.resize-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  bottom: 0;
  right: 0;
  background: rgba(138, 43, 226, 0.5);
  cursor: nwse-resize;
  border-radius: 2px;
}

.browser-window,
.app-window {
  transition: all 0.3s ease-in-out !important;
  transform-origin: center;
}

.browser-window.fullscreen {
  border-radius: 0;
  transition: all 0.4s ease;
}

.control-button {
  background: none;
  border: none;
  color: white;
  cursor: pointer;
  margin-left: 5px;
  font-size: 14px;
  padding: 4px;
}

.control-button:hover {
  color: #8a2be2;
}

.resize-handle {
  position: absolute;
  width: 16px;
  height: 16px;
  bottom: 0;
  right: 0;
  background: rgba(138, 43, 226, 0.5);
  cursor: nwse-resize;
  border-radius: 3px;
}



    </style>
</head>
<body>
    <div class="desktop-icons">
        <div class="app-icon" data-app="browser">
            <div class="icon-img"><i class="fas fa-globe"></i></div>
            <span class="icon-text">Browser</span>
        </div>
        <div class="app-icon"><div class="icon-img"><i class="fas fa-folder"></i></div><span class="icon-text">Files</span></div>
        <div class="app-icon"><div class="icon-img"><i class="fas fa-cog"></i></div><span class="icon-text">Settings</span></div>

<div class="app-icon" data-app="spotify">
    <div class="icon-img"><i class="fab fa-spotify"></i></div>
    <span class="icon-text">Spotify</span>
</div>
<div class="app-icon" data-app="store">
    <div class="icon-img"><i class="fas fa-store"></i></div>
    <span class="icon-text">Store</span>
</div>


    <div class="browser-window" id="browserWindow">
        <div class="browser-header">
            <div class="window-controls">
                <button class="control-button minimize" title="Minimize"><i class="fas fa-minus"></i></button>
                <button class="control-button maximize" title="Maximize"><i class="fas fa-square"></i></button>
                <button class="control-button close" title="Close"><i class="fas fa-times"></i></button>
            </div>
        </div>
        <div class="browser-content">
            <iframe src="https://thisunblockzone.github.io/zora/"></iframe>
        </div>
    </div>

    <div class="taskbar">
        <div class="app-launcher-button"><div class="launcher-circle"></div></div>
<div class="taskbar-icons">
  <div class="taskbar-icon" data-app="browser"><i class="fas fa-globe"></i></div>
  <div class="taskbar-icon" data-app="files"><i class="fas fa-folder"></i></div>
  <div class="taskbar-icon" data-app="settings"><i class="fas fa-cog"></i></div>
  <div class="taskbar-icon" data-app="spotify"><i class="fab fa-spotify"></i></div>
  <div class="taskbar-icon" data-app="store"><i class="fas fa-store"></i></div>
</div>
</i></div>

        </div>
    </div>
    
    <!-- Spotify Window -->
<div class="browser-window" id="spotifyWindow">
        <div class="browser-header">
            <div class="window-controls">
                <button class="control-button minimize" title="Minimize"><i class="fas fa-minus"></i></button>
                <button class="control-button maximize" title="Maximize"><i class="fas fa-square"></i></button>
                <button class="control-button close" title="Close"><i class="fas fa-times"></i></button>
            </div>
        </div>
        <div class="browser-content">
            <iframe src="https://spotfy.one/"></iframe>
        </div>
    </div>


<!-- App Store Window -->
<div class="browser-window" id="storeWindow">
    <div class="window-header">
        <div class="window-title">App Store</div>
        <div class="window-controls">
            <button class="control-button minimize" title="Minimize"><i class="fas fa-minus"></i></button>
            <button class="control-button maximize" title="Maximize"><i class="fas fa-square"></i></button>
            <button class="control-button close" title="Close"><i class="fas fa-times"></i></button>
        </div>
    </div>
    <div class="window-content store-content">
        <div class="app-grid">
            <div class="store-app" data-app="geforcenow">
                <img src="https://play-lh.googleusercontent.com/Kf8WTct65hFJxBUDm51uPIIc7LKQNQpGmLHTJFqKWPuqNxkZ8A9L1xRT0uW2bE_f_w=w240-h480-rw" alt="GeForce Now">
                <div class="app-info">
                    <h3>GeForce Now</h3>
                    <p>Cloud Gaming Platform</p>
                    <button class="install-btn">Install</button>
                </div>
            </div>
            <div class="store-app" data-app="tiktok">
                <img src="https://play-lh.googleusercontent.com/OS-MhSWOPtlUZLt0_UP5TI4juSf0XhyHxGfJa6JrR-64UcOqV5UxCF0C5_OVlYmyEJg=w240-h480-rw" alt="TikTok">
                <div class="app-info">
                    <h3>TikTok</h3>
                    <p>Short-form Videos</p>
                    <button class="install-btn">Install</button>
                </div>
            </div>
            <div class="store-app" data-app="poki">
                <img src="https://play-lh.googleusercontent.com/DTzWtkxfnKwFO3ruybY1SKjJQnLYeuK3KmQmwV5OQ3dULr5iXxeEtzBLceultrKTIUTr=w240-h480-rw" alt="Poki">
                <div class="app-info">
                    <h3>Poki</h3>
                    <p>Online Games</p>
                    <button class="install-btn">Install</button>
                </div>
            </div>
        </div>
    </div>
</div>


    <script>

document.addEventListener("DOMContentLoaded", () => {
    // Constants
    const CORE_APPS = ['browser', 'files', 'settings', 'spotify', 'store'];
    
    // Window elements
    const windows = {
        browser: document.getElementById("browserWindow"),
        spotify: document.getElementById("spotifyWindow"),
        store: document.getElementById("storeWindow")
    };

    // Track window states
    const windowStates = {};
    let zIndexCounter = 1000;
    let activeWindow = null;

    // Initialize window states
    Object.keys(windows).forEach(appName => {
        windowStates[appName] = {
            isActive: false,
            isMaximized: false,
            isDragging: false,
            zIndex: zIndexCounter++
        };
    });

    const allWindows = document.querySelectorAll(".browser-window, .app-window");
    const appIcons = document.querySelectorAll(".app-icon[data-app]");
    const taskbarIcons = document.querySelectorAll(".taskbar-icon[data-app]");

    // Core Functions
    function bringToFront(windowElement) {
        allWindows.forEach(win => win.style.zIndex = 1000);
        if (windowElement) {
            windowElement.style.zIndex = ++zIndexCounter;
        }
    }

    function openWindow(app) {
        const windowEl = windows[app];
        if (!windowEl) return;
        
        windowEl.classList.add("active");
        windowEl.classList.remove("minimized");
        bringToFront(windowEl);
        
        // Only update taskbar for core apps
        if (CORE_APPS.includes(app)) {
            setActiveTaskbarIcon(app);
        }
    }

    function closeWindow(button) {
        const windowEl = button.closest(".browser-window, .app-window");
        if (!windowEl) return;
        windowEl.classList.remove("active", "maximized", "minimized");
        const appName = windowEl.id.replace('Window', '');
        if (CORE_APPS.includes(appName)) {
            clearActiveTaskbarIcon();
        }
    }

    function minimizeWindow(button) {
        const windowEl = button.closest(".browser-window, .app-window");
        if (!windowEl) return;
        windowEl.classList.add("minimized");
        windowEl.classList.remove("active", "maximized");
        const appName = windowEl.id.replace('Window', '');
        if (CORE_APPS.includes(appName)) {
            clearActiveTaskbarIcon();
        }
    }

    function maximizeWindow(button) {
        const windowEl = button.closest(".browser-window, .app-window");
        if (!windowEl) return;
        windowEl.classList.toggle("maximized");
        if (windowEl.classList.contains("maximized")) {
            windowEl.style.width = "100vw";
            windowEl.style.height = "calc(100vh - 50px)";
        } else {
            windowEl.style.width = "";
            windowEl.style.height = "";
        }
        bringToFront(windowEl);
    }

    function setActiveTaskbarIcon(app) {
        if (!CORE_APPS.includes(app)) return;
        taskbarIcons.forEach(icon => {
            if (icon.dataset.app === app) {
                icon.classList.add("active");
            } else {
                icon.classList.remove("active");
            }
        });
    }

    function clearActiveTaskbarIcon() {
        taskbarIcons.forEach(icon => icon.classList.remove("active"));
    }

    // Window Dragging Function
    function makeDraggable(window, header) {
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;

        header.addEventListener("mousedown", (e) => {
            if (e.target.closest(".window-controls")) return;
            if (window.classList.contains("maximized")) return;

            isDragging = true;
            window.style.transition = "none";

            const rect = window.getBoundingClientRect();
            initialX = e.clientX - rect.left;
            initialY = e.clientY - rect.top;

            header.style.cursor = "grabbing";
            bringToFront(window);

            const mouseMoveHandler = (e) => {
                if (!isDragging) return;

                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

                // Constrain to viewport
                const maxX = window.innerWidth - window.offsetWidth;
                const maxY = window.innerHeight - window.offsetHeight - 50;
                currentX = Math.min(Math.max(0, currentX), maxX);
                currentY = Math.min(Math.max(0, currentY), maxY);

                window.style.transform = "none";
                window.style.left = `${currentX}px`;
                window.style.top = `${currentY}px`;
            };

            const mouseUpHandler = () => {
                isDragging = false;
                header.style.cursor = "grab";
                window.style.transition = "";
                
                document.removeEventListener("mousemove", mouseMoveHandler);
                document.removeEventListener("mouseup", mouseUpHandler);
            };

            document.addEventListener("mousemove", mouseMoveHandler);
            document.addEventListener("mouseup", mouseUpHandler);
        });
    }

    // App Installation and Management
    function createBrowserWindow(appName, url, title) {
        const windowId = `${appName}Window`;
        const windowDiv = document.createElement('div');
        windowDiv.className = 'browser-window';
        windowDiv.id = windowId;
        windowDiv.innerHTML = `
            <div class="browser-header">
                <div class="window-title">${title}</div>
                <div class="window-controls">
                    <button class="control-button minimize"><i class="fas fa-minus"></i></button>
                    <button class="control-button maximize"><i class="fas fa-square"></i></button>
                    <button class="control-button close"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div class="browser-content">
                <iframe src="${url}"></iframe>
            </div>
            <div class="resize-handle"></div>
        `;

        document.body.appendChild(windowDiv);
        windowStates[appName] = { 
            isActive: false, 
            isMaximized: false, 
            isDragging: false, 
            zIndex: ++zIndexCounter 
        };
        
        // Initialize window controls
        initializeWindowControls(windowDiv, appName);
        makeDraggable(windowDiv, windowDiv.querySelector('.browser-header'));
        initializeResize(windowDiv);
        
        return windowDiv;
    }

    function initializeWindowControls(window, appName) {
        const controls = window.querySelector('.window-controls');
        if (!controls) return;

        controls.querySelector('.close').addEventListener('click', () => {
            window.classList.remove('active');
            if (CORE_APPS.includes(appName)) {
                clearActiveTaskbarIcon();
            }
        });

        controls.querySelector('.minimize').addEventListener('click', () => {
            window.classList.add('minimized');
            window.classList.remove('active');
            if (CORE_APPS.includes(appName)) {
                clearActiveTaskbarIcon();
            }
        });

        controls.querySelector('.maximize').addEventListener('click', () => {
            window.classList.toggle('maximized');
            if (window.classList.contains('maximized')) {
                window.style.width = '100vw';
                window.style.height = 'calc(100vh - 50px)';
            } else {
                window.style.width = '';
                window.style.height = '';
            }
        });
    }

    function initializeResize(window) {
        const resizeHandle = window.querySelector('.resize-handle');
        if (!resizeHandle) return;

        let isResizing = false;
        let startX, startY, startWidth, startHeight;

        resizeHandle.addEventListener('mousedown', (e) => {
            isResizing = true;
            startX = e.clientX;
            startY = e.clientY;
            startWidth = window.offsetWidth;
            startHeight = window.offsetHeight;
            bringToFront(window);

            const mouseMoveHandler = (e) => {
                if (!isResizing) return;

                const newWidth = startWidth + (e.clientX - startX);
                const newHeight = startHeight + (e.clientY - startY);

                if (newWidth >= 400) window.style.width = newWidth + 'px';
                if (newHeight >= 300) window.style.height = newHeight + 'px';
            };

            const mouseUpHandler = () => {
                isResizing = false;
                document.removeEventListener('mousemove', mouseMoveHandler);
                document.removeEventListener('mouseup', mouseUpHandler);
            };

            document.addEventListener('mousemove', mouseMoveHandler);
            document.addEventListener('mouseup', mouseUpHandler);
        });
    }

    // App Store Installation
// App Store Installation
document.querySelectorAll(".install-btn").forEach(btn => {
    btn.addEventListener("click", () => {
        const appContainer = btn.closest(".store-app");
        const appId = appContainer.dataset.app;
        const appName = appContainer.querySelector("h3").textContent;
        const appImg = appContainer.querySelector("img").src;

        if (btn.classList.contains('remove-btn')) {
            // Remove app
            const icon = document.querySelector(`.app-icon[data-app="${appId}"]`);
            const win = windows[appId];
            if (icon) icon.remove();
            if (win) win.remove();
            delete windows[appId];
            
            // Update localStorage
            const installedApps = JSON.parse(localStorage.getItem('installedApps') || '[]');
            const updatedApps = installedApps.filter(app => app !== appId);
            localStorage.setItem('installedApps', JSON.stringify(updatedApps));
            
            // Update button
            btn.innerHTML = `<i class="fas fa-download"></i> Install`;
            btn.classList.remove('remove-btn');
            return;
        }

        if (windows[appId]) return alert(`${appName} is already installed.`);

        // Create desktop icon
        const desktopIcons = document.querySelector(".desktop-icons");
        const newIcon = document.createElement("div");
        newIcon.className = "app-icon";
        newIcon.dataset.app = appId;
        newIcon.innerHTML = `
            <div class="icon-img"><img src="${appImg}" style="width: 100%; height: 100%; border-radius: 10px;"></div>
            <span class="icon-text">${appName}</span>
        `;

        desktopIcons.appendChild(newIcon);

        // Create browser-window style window
        const win = document.createElement("div");
        win.className = "browser-window";
        win.id = `${appId}Window`;
        win.innerHTML = `
            <div class="browser-header">
                <div class="window-title">${appName}</div>
                <div class="window-controls">
                    <button class="control-button minimize" title="Minimize"><i class="fas fa-minus"></i></button>
                    <button class="control-button maximize" title="Maximize"><i class="fas fa-square"></i></button>
                    <button class="control-button close" title="Close"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div class="browser-content">
                <iframe src="${getAppUrl(appId)}"></iframe>
            </div>
        `;
        document.body.appendChild(win);

        // Initialize window functionality
        windows[appId] = win;
        makeDraggable(win, win.querySelector('.browser-header'));
        initializeWindowControls(win, appId);
        initializeResize(win);

        // Add click handler to icon
        newIcon.addEventListener("click", () => {
            win.classList.remove("minimized");
            win.classList.add("active");
            bringToFront(win);
        });

        // Update button to show Remove option
        btn.innerHTML = `<i class="fas fa-trash"></i> Remove`;
        btn.classList.add('remove-btn');

        // Save to localStorage
        const installedApps = JSON.parse(localStorage.getItem('installedApps') || '[]');
        if (!installedApps.includes(appId)) {
            installedApps.push(appId);
            localStorage.setItem('installedApps', JSON.stringify(installedApps));
        }
    });
});

// Helper function to get app URL
function getAppUrl(appName) {
    const urls = {
        geforcenow: 'https://thisunblockzone.github.io/active/iframe.html#https://play.geforcenow.com',
        tiktok: 'https://thisunblockzone.github.io/active/iframe.html#https://tiktok.com',
        poki: 'https://thisunblockzone.github.io/active/iframe.html#https://poki.com'
    };
    return urls[appName] || '';
}

// Load installed apps on startup
function loadInstalledApps() {
    const installedApps = JSON.parse(localStorage.getItem('installedApps') || '[]');
    installedApps.forEach(appId => {
        const storeApp = document.querySelector(`.store-app[data-app="${appId}"]`);
        if (storeApp) {
            const btn = storeApp.querySelector('.install-btn');
            if (btn) {
                btn.innerHTML = `<i class="fas fa-trash"></i> Remove`;
                btn.classList.add('remove-btn');
            }
            // Trigger installation
            btn.click();
            btn.classList.add('remove-btn');
            btn.innerHTML = `<i class="fas fa-trash"></i> Remove`;
        }
    });
}

// Call on page load
loadInstalledApps();


    // Event Listeners for Core Apps
    appIcons.forEach(icon => {
        const app = icon.dataset.app;
        if (app) {
            icon.addEventListener("click", () => openWindow(app));
        }
    });

    taskbarIcons.forEach(icon => {
        const app = icon.dataset.app;
        if (app) {
            icon.addEventListener("click", () => {
                const win = windows[app];
                if (!win) return;

                if (win.classList.contains("minimized")) {
                    win.classList.remove("minimized");
                    win.classList.add("active");
                    bringToFront(win);
                } else if (win.classList.contains("active")) {
                    win.classList.add("minimized");
                    win.classList.remove("active");
                } else {
                    win.classList.add("active");
                    bringToFront(win);
                }
            });
        }
    });
});

 </script>
 
 <script>

// Window Control Functions
function initializeWindowControls(window, appName) {
    const controls = window.querySelector('.window-controls');
    if (!controls) return;

    // Close Button
    controls.querySelector('.close').addEventListener('click', () => {
        window.classList.remove('active');
        window.classList.add('minimized');
    });

    // Minimize Button
    controls.querySelector('.minimize').addEventListener('click', () => {
        window.classList.add('minimized');
        window.classList.remove('active', 'maximized');
    });

    // Maximize Button
    controls.querySelector('.maximize').addEventListener('click', () => {
        window.classList.toggle('maximized');
        if (window.classList.contains('maximized')) {
            window.style.transform = 'none';
            window.style.top = '0';
            window.style.left = '0';
            window.style.width = '100vw';
            window.style.height = 'calc(100vh - 50px)';
            window.style.borderRadius = '0';
        } else {
            window.style.width = '90vw';
            window.style.height = '85vh';
            window.style.borderRadius = '12px';
            window.style.top = '50%';
            window.style.left = '50%';
            window.style.transform = 'translate(-50%, -50%)';
        }
    });

    // Double-click header to maximize
    const header = window.querySelector('.browser-header');
    if (header) {
        header.addEventListener('dblclick', (e) => {
            if (!e.target.closest('.window-controls')) {
                controls.querySelector('.maximize').click();
            }
        });
    }
}

// Update the createBrowserWindow function
function createBrowserWindow(appName, url, title) {
    const windowId = `${appName}Window`;
    const windowDiv = document.createElement('div');
    windowDiv.className = 'browser-window';
    windowDiv.id = windowId;
    windowDiv.innerHTML = `
        <div class="browser-header">
            <div class="window-title">${title}</div>
            <div class="window-controls">
                <button class="control-button minimize" title="Minimize">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="control-button maximize" title="Maximize">
                    <i class="fas fa-square"></i>
                </button>
                <button class="control-button close" title="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="browser-content">
            <iframe src="${url}"></iframe>
        </div>
    `;

    document.body.appendChild(windowDiv);
    
    // Initialize window controls
    initializeWindowControls(windowDiv, appName);
    makeDraggable(windowDiv, windowDiv.querySelector('.browser-header'));
    
    // Add to windows object
    windows[appName] = windowDiv;
    windowStates[appName] = {
        isActive: false,
        isMaximized: false,
        isDragging: false,
        zIndex: ++zIndexCounter
    };

    return windowDiv;
}

// Add taskbar click handlers for minimized windows
function initializeTaskbarHandlers() {
    taskbarIcons.forEach(icon => {
        const app = icon.dataset.app;
        if (app && windows[app]) {
            icon.addEventListener('click', () => {
                const win = windows[app];
                if (win.classList.contains('minimized')) {
                    win.classList.remove('minimized');
                    win.classList.add('active');
                    bringToFront(win);
                } else if (win.classList.contains('active')) {
                    win.classList.add('minimized');
                    win.classList.remove('active');
                } else {
                    win.classList.add('active');
                    bringToFront(win);
                }
            });
        }
    });
}

// Add this CSS to ensure proper window behavior
const styleSheet = document.createElement('style');
styleSheet.textContent = `
    .browser-window {
        transition: all 0.3s ease;
    }
`;

document.head.appendChild(styleSheet);

// Initialize everything when the DOM loads
document.addEventListener('DOMContentLoaded', () => {
    // Initialize existing windows
    Object.keys(windows).forEach(appName => {
        const window = windows[appName];
        if (window) {
            initializeWindowControls(window, appName);
            makeDraggable(window, window.querySelector('.browser-header'));
        }
    });

    // Initialize taskbar handlers
    initializeTaskbarHandlers();
});

</script>

<script>
document.querySelectorAll('.browser-window').forEach(windowEl => {
  const header = windowEl.querySelector('.browser-header, .window-header');
  const minimizeBtn = windowEl.querySelector('.control-button.minimize');
  const maximizeBtn = windowEl.querySelector('.control-button.maximize');
  const closeBtn = windowEl.querySelector('.control-button.close');
  const appId = windowEl.id;
  const taskbarIcon = document.querySelector(`.taskbar-icon[data-app="${appId.replace('Window', '').toLowerCase()}"]`);

  let isDragging = false, isMaximized = false, isMinimized = false, resizing = false;
  let offsetX = 0, offsetY = 0;
  let originalRect = {};

  // ===== DRAGGING =====
  header?.addEventListener('mousedown', (e) => {
    if (e.target.closest('.control-button')) return;
    isDragging = true;
    offsetX = e.clientX - windowEl.getBoundingClientRect().left;
    offsetY = e.clientY - windowEl.getBoundingClientRect().top;
    windowEl.style.transition = 'none';
  });

  document.addEventListener('mousemove', (e) => {
    if (!isDragging || isMaximized) return;
    windowEl.style.left = e.clientX - offsetX + 'px';
    windowEl.style.top = e.clientY - offsetY + 'px';
    windowEl.style.transform = 'none';
  });

  document.addEventListener('mouseup', () => isDragging = false);

  // ===== MINIMIZE =====
  minimizeBtn?.addEventListener('click', () => {
    isMinimized = true;
    windowEl.style.transform = 'scale(0.9) translateY(100%)';
    windowEl.style.opacity = '0';
    setTimeout(() => windowEl.style.display = 'none', 300);
  });

  // ===== CLOSE =====
  closeBtn?.addEventListener('click', () => {
    windowEl.classList.remove('active');
    windowEl.style.opacity = 0;
    windowEl.style.visibility = 'hidden';
  });

  // ===== FULLSCREEN =====
  maximizeBtn?.addEventListener('click', () => {
    if (!isMaximized) {
      originalRect = {
        left: windowEl.style.left,
        top: windowEl.style.top,
        width: windowEl.style.width,
        height: windowEl.style.height,
        transform: windowEl.style.transform
      };
      windowEl.classList.add('fullscreen');
      Object.assign(windowEl.style, {
        left: '0',
        top: '0',
        width: '100vw',
        height: '100vh',
        transform: 'none'
      });
    } else {
      windowEl.classList.remove('fullscreen');
      Object.assign(windowEl.style, originalRect);
    }
    isMaximized = !isMaximized;
  });

  // ===== RESIZE HANDLE =====
  const handle = document.createElement('div');
  handle.className = 'resize-handle';
  windowEl.appendChild(handle);

  handle.addEventListener('mousedown', (e) => {
    e.preventDefault();
    resizing = true;
    windowEl.style.transition = 'none';
  });

  document.addEventListener('mousemove', (e) => {
    if (!resizing) return;
    const rect = windowEl.getBoundingClientRect();
    windowEl.style.width = e.clientX - rect.left + 'px';
    windowEl.style.height = e.clientY - rect.top + 'px';
  });

  document.addEventListener('mouseup', () => resizing = false);

  // ===== TASKBAR REOPEN =====
  taskbarIcon?.addEventListener('click', () => {
    if (isMinimized) {
      isMinimized = false;
      windowEl.style.display = 'block';
      setTimeout(() => {
        windowEl.style.opacity = '1';
        windowEl.style.transform = 'translate(-50%, -50%) scale(1)';
      }, 10);
    } else {
      // Toggle visibility
      const visible = windowEl.style.display !== 'none' && windowEl.style.opacity !== '0';
      if (!visible) {
        windowEl.style.display = 'block';
        windowEl.style.opacity = '1';
        windowEl.style.transform = 'translate(-50%, -50%) scale(1)';
      } else {
        windowEl.style.opacity = '0';
        windowEl.style.transform = 'scale(0.9) translateY(100%)';
        setTimeout(() => windowEl.style.display = 'none', 300);
      }
    }
  });
});

document.querySelectorAll('.control-button.close').forEach(button => {
  button.addEventListener('click', () => {
    const windowElement = button.closest('.browser-window');
    closeWindow(windowElement);
  });
});

document.querySelectorAll('.control-button.minimize').forEach(button => {
  button.addEventListener('click', () => {
    const windowElement = button.closest('.browser-window');
    windowElement.classList.remove('active');
  });
});

document.querySelectorAll('.control-button.maximize').forEach(button => {
  button.addEventListener('click', () => {
    const windowElement = button.closest('.browser-window');
    windowElement.classList.toggle('fullscreen');
  });
});

// Function to open the window
function openWindow(windowElement) {
  windowElement.classList.remove('closing');
  windowElement.classList.add('active');
}

</script>



</body>
</html>
